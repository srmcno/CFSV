# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
#
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
#
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrMyReservations:
    Properties:
      Fill: =varTheme.Background
      LoadingSpinnerColor: =RGBA(98, 100, 167, 1)
      OnVisible: |-
        =ClearCollect(
            colMyReservations,
            Sort(
                Filter(
                    'Vehicle Reservations',
                    Associate.Associates = varUserAssociate.Associates
                ),
                StartDateTime,
                SortOrder.Descending
            )
        );
        Set(varResFilter, "Upcoming")
    Children:
      # ══════════════════════════════════════════════════════════════
      # HEADER (84px) – Title, subtitle with count, back button
      # ══════════════════════════════════════════════════════════════
      - cmpHeader_MyRes:
          Control: CanvasComponent
          ComponentName: cmpHeader
          Properties:
            Height: =84
            ShowBackBtn: =true
            SubTitle: =CountRows(colMyReservations) & " total"
            Title: ="My Reservations"
            Width: =App.Width

      # ══════════════════════════════════════════════════════════════
      # FILTER BAR (52px) – Pill-shaped Upcoming / Past / All toggles
      # ══════════════════════════════════════════════════════════════
      - cnrResFilters:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =varTheme.Surface
            Height: =52
            PaddingBottom: =0.00
            PaddingLeft: =0.00
            Width: =Parent.Width
            Y: =cmpHeader_MyRes.Height
          Children:
            - btnFilterUpcoming:
                Control: Button@0.0.45
                Properties:
                  BasePaletteColor: =If(varResFilter = "Upcoming", varTheme.Primary, Color.Transparent)
                  FontColor: =If(varResFilter = "Upcoming", varTheme.TextOnPrimary, varTheme.TextSecondary)
                  Height: =36
                  OnSelect: =Set(varResFilter, "Upcoming")
                  Text: ="Upcoming"
                  Width: =(Parent.Width - 48) / 3
                  X: =12
                  Y: =8
            - btnFilterPast:
                Control: Button@0.0.45
                Properties:
                  BasePaletteColor: =If(varResFilter = "Past", varTheme.Primary, Color.Transparent)
                  FontColor: =If(varResFilter = "Past", varTheme.TextOnPrimary, varTheme.TextSecondary)
                  Height: =36
                  OnSelect: =Set(varResFilter, "Past")
                  Text: ="Past"
                  Width: =(Parent.Width - 48) / 3
                  X: =(Parent.Width - 48) / 3 + 20
                  Y: =8
            - btnFilterAll:
                Control: Button@0.0.45
                Properties:
                  BasePaletteColor: =If(varResFilter = "All", varTheme.Primary, Color.Transparent)
                  FontColor: =If(varResFilter = "All", varTheme.TextOnPrimary, varTheme.TextSecondary)
                  Height: =36
                  OnSelect: =Set(varResFilter, "All")
                  Text: ="All"
                  Width: =(Parent.Width - 48) / 3
                  X: =((Parent.Width - 48) / 3) * 2 + 28
                  Y: =8

      # ══════════════════════════════════════════════════════════════
      # RESERVATION GALLERY – Cards with accent bar, info, badge, cancel
      # ══════════════════════════════════════════════════════════════
      - galMyReservations:
          Control: Gallery@2.15.0
          Variant: BrowseLayout_Vertical_OneTextVariant_pcfCore
          Properties:
            BorderColor: =RGBA(243, 242, 241, 1)
            FocusedBorderColor: =RGBA(98, 100, 167, 1)
            FocusedBorderThickness: =2
            Height: =Parent.Height - cmpHeader_MyRes.Height - cnrResFilters.Height - cmpBottomNav_MyRes.Height
            Items: |-
              =Filter(
                  colMyReservations,
                  Switch(
                      varResFilter,
                      "Upcoming", EndDateTime >= Today(),
                      "Past", EndDateTime < Today(),
                      true
                  )
              )
            LoadingSpinner: =LoadingSpinner.Controls
            TemplatePadding: =6
            TemplateSize: =108
            Visible: =CountRows(colMyReservations) > 0
            Width: =Parent.Width
            Y: =cmpHeader_MyRes.Height + cnrResFilters.Height
          Children:
            - cnrResCard:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =Parent.TemplateHeight - 6
                  PaddingBottom: =0.00
                  PaddingLeft: =0.00
                  RadiusBottomLeft: =16
                  RadiusBottomRight: =16
                  RadiusTopLeft: =16
                  RadiusTopRight: =16
                  Width: =Parent.TemplateWidth - 24
                  X: =12
                  Y: =0.00
                Children:
                  # ── 6px left status accent bar ──
                  - recResAccent:
                      Control: Rectangle@2.3.0
                      Properties:
                        Fill: |-
                          =Switch(
                              ThisItem.'Status (cr63e_status)',
                              'Status (Vehicle Reservations)'.Approved, varStatusColors.Approved,
                              'Status (Vehicle Reservations)'.Submitted, varStatusColors.Submitted,
                              'Status (Vehicle Reservations)'.CheckedOut, varStatusColors.CheckedOut,
                              'Status (Vehicle Reservations)'.Returned, varStatusColors.Available,
                              'Status (Vehicle Reservations)'.Cancelled, varStatusColors.Cancelled,
                              'Status (Vehicle Reservations)'.Draft, varStatusColors.Draft,
                              RGBA(96, 94, 92, 1)
                          )
                        Height: =Parent.Height
                        RadiusBottomLeft: =16
                        RadiusTopLeft: =16
                        Width: =6
                  # ── Vehicle name (15px bold) ──
                  - lblResVehicle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =26
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Size: =15
                        Text: =ThisItem.Vehicle.'Vehicle Name'
                        Width: =Parent.Width - 130
                        X: =20
                        Y: =10
                  # ── Date range (12px) ──
                  - lblResDates:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =20
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Size: =12
                        Text: =Text(ThisItem.StartDateTime, "mmm d") & " – " & Text(ThisItem.EndDateTime, "mmm d, yyyy")
                        Width: =Parent.Width - 130
                        X: =20
                        Y: =38
                  # ── Purpose (11px, truncated single line) ──
                  - lblResPurpose:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextTertiary
                        Height: =18
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Size: =11
                        Text: =ThisItem.Purpose
                        Visible: =!IsBlank(ThisItem.Purpose)
                        Width: =Parent.Width - 130
                        X: =20
                        Y: =60
                  # ── Status badge (pill, 24px height, colored bg) ──
                  - cnrStatusBadge:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: |-
                          =ColorFade(
                              Switch(
                                  ThisItem.'Status (cr63e_status)',
                                  'Status (Vehicle Reservations)'.Approved, varStatusColors.Approved,
                                  'Status (Vehicle Reservations)'.Submitted, varStatusColors.Submitted,
                                  'Status (Vehicle Reservations)'.CheckedOut, varStatusColors.CheckedOut,
                                  'Status (Vehicle Reservations)'.Returned, varStatusColors.Available,
                                  'Status (Vehicle Reservations)'.Cancelled, varStatusColors.Cancelled,
                                  'Status (Vehicle Reservations)'.Draft, varStatusColors.Draft,
                                  RGBA(96, 94, 92, 1)
                              ),
                              80%
                          )
                        Height: =24
                        PaddingBottom: =0.00
                        PaddingLeft: =0.00
                        RadiusBottomLeft: =12
                        RadiusBottomRight: =12
                        RadiusTopLeft: =12
                        RadiusTopRight: =12
                        Width: =88
                        X: =Parent.Width - 100
                        Y: =12
                      Children:
                        - lblResStatus:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              Color: |-
                                =Switch(
                                    ThisItem.'Status (cr63e_status)',
                                    'Status (Vehicle Reservations)'.Approved, varStatusColors.Approved,
                                    'Status (Vehicle Reservations)'.Submitted, varStatusColors.Submitted,
                                    'Status (Vehicle Reservations)'.CheckedOut, varStatusColors.CheckedOut,
                                    'Status (Vehicle Reservations)'.Returned, varStatusColors.Available,
                                    'Status (Vehicle Reservations)'.Cancelled, varStatusColors.Cancelled,
                                    'Status (Vehicle Reservations)'.Draft, varStatusColors.Draft,
                                    RGBA(96, 94, 92, 1)
                                )
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              Size: =10
                              Text: =Upper(Text(ThisItem.'Status (cr63e_status)'))
                              Width: =Parent.Width
                  # ── Cancel button (Approved + future only) ──
                  - btnCancelRes_1:
                      Control: Button@0.0.45
                      Properties:
                        Appearance: ="Secondary"
                        BasePaletteColor: =varTheme.Danger
                        FontColor: =varTheme.Danger
                        Height: =36
                        OnSelect: =Set(varConfirmCancelRes, ThisItem)
                        Text: ="Cancel"
                        Width: =88
                        X: =Parent.Width - 100
                        Y: =Parent.Height - 46
                        Visible: =ThisItem.EndDateTime >= Today() && ThisItem.'Status (cr63e_status)' = 'Status (Vehicle Reservations)'.Approved

      # ══════════════════════════════════════════════════════════════
      # EMPTY STATE – Calendar icon, message, CTA button
      # ══════════════════════════════════════════════════════════════
      - cnrNoReservations:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =varTheme.Surface
            Height: =200
            PaddingBottom: =0.00
            PaddingLeft: =0.00
            RadiusBottomLeft: =16
            RadiusBottomRight: =16
            RadiusTopLeft: =16
            RadiusTopRight: =16
            Visible: =CountRows(colMyReservations) = 0
            Width: =Parent.Width - 32
            X: =16
            Y: =cmpHeader_MyRes.Height + cnrResFilters.Height + 32
          Children:
            - icoNoRes:
                Control: Icon@0.0.7
                Properties:
                  Height: =40
                  Icon: ="Calendar"
                  IconColor: =varTheme.TextTertiary
                  Width: =40
                  X: =(Parent.Width - 40) / 2
                  Y: =24
            - lblNoResText:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Center
                  Color: =varTheme.TextSecondary
                  Height: =28
                  Size: =14
                  Text: ="No reservations yet"
                  Width: =Parent.Width
                  Y: =72
            - lblNoResSubtext:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Center
                  Color: =varTheme.TextTertiary
                  Height: =22
                  Size: =11
                  Text: ="Reserve a vehicle to get started"
                  Width: =Parent.Width
                  Y: =98
            - btnMakeRes:
                Control: Button@0.0.45
                Properties:
                  BasePaletteColor: =varTheme.Primary
                  FontColor: =varTheme.TextOnPrimary
                  Height: =44
                  OnSelect: |-
                    =Set(varSelectedVehicle, Blank());
                    Set(varIsNewReservation, true);
                    Navigate(scrReservation, ScreenTransition.Fade)
                  Text: ="Make a reservation"
                  Width: =200
                  X: =(Parent.Width - 200) / 2
                  Y: =132

      # ══════════════════════════════════════════════════════════════
      # CANCEL CONFIRMATION OVERLAY – Dark backdrop + centered dialog
      # ══════════════════════════════════════════════════════════════
      - cnrConfirmCancelRes:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(0, 0, 0, 0.5)
            Height: =Parent.Height
            PaddingBottom: =0.00
            PaddingLeft: =0.00
            Visible: =!IsBlank(varConfirmCancelRes)
            Width: =Parent.Width
          Children:
            - cnrConfirmDialog:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =220
                  PaddingBottom: =0.00
                  PaddingLeft: =0.00
                  RadiusBottomLeft: =16
                  RadiusBottomRight: =16
                  RadiusTopLeft: =16
                  RadiusTopRight: =16
                  Width: =Parent.Width - 64
                  X: =32
                  Y: =(Parent.Height - 220) / 2
                Children:
                  - lblConfirmTitle:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =32
                        Size: =16
                        Text: ="Cancel Reservation?"
                        Width: =Parent.Width
                        Y: =20
                  - lblConfirmMessage:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =varTheme.TextSecondary
                        Height: =50
                        Size: =12
                        Text: =If(!IsBlank(varConfirmCancelRes), "Cancel reservation for " & varConfirmCancelRes.Vehicle.'Vehicle Name' & " on " & Text(varConfirmCancelRes.StartDateTime, "mmm d, yyyy") & "?", "")
                        Width: =Parent.Width - 32
                        X: =16
                        Y: =56
                  - btnConfirmYes:
                      Control: Button@0.0.45
                      Properties:
                        BasePaletteColor: =varTheme.Danger
                        FontColor: =varTheme.TextOnPrimary
                        Height: =44
                        OnSelect: |-
                          =Patch(
                              'Vehicle Reservations',
                              varConfirmCancelRes,
                              {'Status (cr63e_status)': 'Status (Vehicle Reservations)'.Cancelled}
                          );
                          Notify("Reservation cancelled", NotificationType.Success);
                          Set(varConfirmCancelRes, Blank());
                          ClearCollect(
                              colMyReservations,
                              Sort(
                                  Filter(
                                      'Vehicle Reservations',
                                      Associate.Associates = varUserAssociate.Associates
                                  ),
                                  StartDateTime,
                                  SortOrder.Descending
                              )
                          )
                        Text: ="Yes, Cancel It"
                        Width: =Parent.Width - 32
                        X: =16
                        Y: =114
                  - btnConfirmNo:
                      Control: Button@0.0.45
                      Properties:
                        Appearance: ="Secondary"
                        Height: =44
                        OnSelect: =Set(varConfirmCancelRes, Blank())
                        Text: ="Go Back"
                        Width: =Parent.Width - 32
                        X: =16
                        Y: =164

      # ══════════════════════════════════════════════════════════════
      # BOTTOM NAV (72px)
      # ══════════════════════════════════════════════════════════════
      - cmpBottomNav_MyRes:
          Control: CanvasComponent
          ComponentName: cmpBottomNav
          Properties:
            ActiveKey: ="More"
            Height: =72
            Width: =App.Width
            Y: =Parent.Height - Self.Height
