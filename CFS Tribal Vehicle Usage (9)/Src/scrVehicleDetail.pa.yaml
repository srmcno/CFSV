# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
#
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
#
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrVehicleDetail:
    Properties:
      Fill: =varTheme.Background
      LoadingSpinnerColor: =RGBA(98, 100, 167, 1)
      OnVisible: "=// Load reservations for this vehicle\r\n        ClearCollect(\r\n            colVehicleReservations,\r\n            Filter(\r\n                'Vehicle Reservations',\r\n                Vehicle.CFSVehicles = varSelectedVehicle.CFSVehicles &&\r\n                EndDateTime >= Today()\r\n            )\r\n        );\r\n        \r\n        // Get fuel card info\r\n        Set(\r\n            varVehicleFuelCard,\r\n            LookUp(\r\n                'Fuel Card Assignments',\r\n                Vehicle.CFSVehicles = varSelectedVehicle.CFSVehicles\r\n            )\r\n        );"
    Children:
      - cmpHeader_Detail:
          Control: CanvasComponent
          ComponentName: cmpHeader
          Properties:
            Height: =64
            ShowBackBtn: =true
            SubTitle: =varSelectedVehicle.Year & " " & varSelectedVehicle.Make & " " & varSelectedVehicle.Model
            Title: =varSelectedVehicle.'Vehicle Name'
            Width: =App.Width
      - cmpBottomNav_Detail:
          Control: CanvasComponent
          ComponentName: cmpBottomNav
          Properties:
            ActiveKey: ="Vehicles"
            Height: =56
            Width: =App.Width
            Y: =Parent.Height - Self.Height
      - cnrDetailContent:
          Control: GroupContainer@1.4.0
          Variant: AutoLayout
          Properties:
            Fill: =Color.Transparent
            Height: =Parent.Height - cmpHeader_Detail.Height - cmpBottomNav_Detail.Height
            LayoutAlignItems: =LayoutAlignItems.Center
            LayoutDirection: =LayoutDirection.Vertical
            LayoutGap: =12
            LayoutOverflowY: =LayoutOverflow.Scroll
            LayoutWrap: =true
            PaddingBottom: =16
            Width: =Parent.Width
            Y: =cmpHeader_Detail.Height
          Children:
            - cnrStatusBanner:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  Fill: =Switch(Text(varSelectedVehicle.'Status (cr63e_status)'), "Available", varStatusColors.Available, "Checked Out", varStatusColors.CheckedOut, "Reserved", varStatusColors.Reserved, "Maintenance", varStatusColors.Maintenance, RGBA(96, 94, 92, 1))
                  FillPortions: =0
                  Height: =36
                  Width: =Parent.Width
                Children:
                  - lblStatusBanner:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =RGBA(255, 255, 255, 1)
                        FontWeight: =FontWeight.Semibold
                        Height: =Parent.Height
                        Size: =14
                        Text: =Upper(Text(varSelectedVehicle.'Status (cr63e_status)'))
                        Width: =Parent.Width
            - cnrInfoCard:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  Fill: =varTheme.Surface
                  FillPortions: =0
                  Height: =If(Text(varSelectedVehicle.'Status (cr63e_status)') = "Checked Out", 220, 200)
                  LayoutMinWidth: =0
                  RadiusBottomLeft: =12
                  RadiusBottomRight: =12
                  RadiusTopLeft: =12
                  RadiusTopRight: =12
                  Width: =Parent.Width - 32
                Children:
                  - lblInfoTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =14
                        Text: ="Vehicle Information"
                        Width: =Parent.Width - 32
                        X: =16
                        Y: =10
                  - lblTagLabel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =22
                        Size: =12
                        Text: ="Tag"
                        Width: =100
                        X: =16
                        Y: =38
                  - lblTagValue:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Right
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =12
                        Text: =varSelectedVehicle.Tag
                        Width: =Parent.Width - 132
                        X: =116
                        Y: =38
                  - lblVINLabel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =22
                        Size: =12
                        Text: ="VIN"
                        Width: =100
                        X: =16
                        Y: =62
                  - lblVINValue:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Right
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =10
                        Text: =If(!IsBlank(varSelectedVehicle.VIN), varSelectedVehicle.VIN, "â€”")
                        Width: =Parent.Width - 132
                        X: =116
                        Y: =62
                  - lblOfficeLabel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =22
                        Size: =12
                        Text: ="Assigned Office"
                        Width: =100
                        X: =16
                        Y: =86
                  - lblOfficeValue:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Right
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =12
                        Text: =varSelectedVehicle.Location
                        Width: =Parent.Width - 132
                        X: =116
                        Y: =86
                  - lblFuelCardLabel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =22
                        Size: =12
                        Text: ="Fuel Card (Last 4)"
                        Width: =120
                        X: =16
                        Y: =110
                  - lblFuelCardValue:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Right
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =12
                        Text: =If(IsBlank(varVehicleFuelCard), "Not Assigned", "****" & varVehicleFuelCard.CardLast4)
                        Width: =Parent.Width - 152
                        X: =136
                        Y: =110
                  - lblMileageLabel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =22
                        Size: =12
                        Text: ="Current Mileage"
                        Width: =120
                        X: =16
                        Y: =134
                  - lblMileageValue:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Right
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =12
                        Text: =Text(varSelectedVehicle.'Current Mileage', "#,##0") & " mi"
                        Width: =Parent.Width - 152
                        X: =136
                        Y: =134
                  - lblCheckedOutBy:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varStatusColors.CheckedOut
                        FontWeight: =FontWeight.Semibold
                        Height: =22
                        Size: =12
                        Text: |-
                          ="Checked out by: " & LookUp('Vehicle Checkouts', Vehicle.CFSVehicles = varSelectedVehicle.CFSVehicles && IsBlank(ReturnedAt)).Associate.Associate
                        Visible: =Text(varSelectedVehicle.'Status (cr63e_status)') = "Checked Out"
                        Width: =Parent.Width - 32
                        X: =16
                        Y: =162
            - cnrActions:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  FillPortions: =0
                  Height: =44
                  LayoutAlignItems: =LayoutAlignItems.Center
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =12
                  LayoutJustifyContent: =LayoutJustifyContent.Center
                  PaddingLeft: =16
                  PaddingRight: =16
                  Width: =Parent.Width
                Children:
                  - btnReserveThis:
                      Control: Button@0.0.45
                      Properties:
                        BasePaletteColor: =varTheme.Primary
                        FillPortions: =1
                        Height: =44
                        OnSelect: |-
                          =Set(varIsNewReservation, true);
                          Navigate(scrReservation, ScreenTransition.Fade)
                        Text: ="Reserve"
                        Visible: =Text(varSelectedVehicle.'Status (cr63e_status)') = "Available"
                  - btnCheckOut:
                      Control: Button@0.0.45
                      Properties:
                        BasePaletteColor: =varStatusColors.CheckedOut
                        FillPortions: =1
                        Height: =44
                        OnSelect: |-
                          =Patch(
                              'Vehicle Checkouts',
                              Defaults('Vehicle Checkouts'),
                              {
                                  Vehicle: varSelectedVehicle,
                                  Associate: varUserAssociate,
                                  CheckedOutAt: Now()
                              }
                          );

                          Patch(
                              CFSVehicles,
                              varSelectedVehicle,
                              {'Status (cr63e_status)': 'Status (CFSVehicles)'.'Checked Out'}
                          );

                          Notify("Vehicle checked out!", NotificationType.Success);
                          Navigate(scrVehicleList, ScreenTransition.Fade)
                        Text: ="Check Out"
                        Visible: =Text(varSelectedVehicle.'Status (cr63e_status)') = "Available"
                  - btnCheckIn:
                      Control: Button@0.0.45
                      Properties:
                        BasePaletteColor: =varStatusColors.Available
                        FillPortions: =1
                        Height: =44
                        OnSelect: |-
                          =With(
                              {openCheckout: LookUp('Vehicle Checkouts', Vehicle.CFSVehicles = varSelectedVehicle.CFSVehicles && IsBlank(ReturnedAt))},
                              If(
                                  !IsBlank(openCheckout),
                                  Patch('Vehicle Checkouts', openCheckout, {ReturnedAt: Now()})
                              )
                          );

                          Patch(
                              CFSVehicles,
                              varSelectedVehicle,
                              {'Status (cr63e_status)': 'Status (CFSVehicles)'.Available}
                          );

                          Notify("Vehicle checked in!", NotificationType.Success);
                          Navigate(scrVehicleList, ScreenTransition.Fade)
                        Text: ="Check In Vehicle"
                        Visible: =Text(varSelectedVehicle.'Status (cr63e_status)') = "Checked Out"
            - lblUpcomingTitle:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Center
                  Color: =varTheme.TextPrimary
                  FontWeight: =FontWeight.Semibold
                  Height: =24
                  PaddingLeft: =16
                  Size: =14
                  Text: ="Upcoming Reservations"
                  Visible: =CountRows(colVehicleReservations) > 0
                  Width: =Parent.Width - 32
            - galUpcoming:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_OneTextVariant_pcfCore
                Properties:
                  AlignInContainer: =AlignInContainer.SetByContainer
                  BorderColor: =RGBA(243, 242, 241, 1)
                  FillPortions: =0
                  FocusedBorderColor: =RGBA(98, 100, 167, 1)
                  FocusedBorderThickness: =2
                  Height: =Min(CountRows(colVehicleReservations) * 56, 224)
                  Items: =colVehicleReservations
                  TemplateSize: =52
                  Visible: =CountRows(colVehicleReservations) > 0
                  Width: =Parent.Width - 32
                Children:
                  - cnrResItem:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.PrimaryLight
                        Height: =48
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                        Width: =Parent.TemplateWidth
                      Children:
                        - lblResDate:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =22
                              Size: =12
                              Text: =Text(ThisItem.StartDateTime, "mmm d") & " - " & Text(ThisItem.EndDateTime, "mmm d, yyyy")
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =4
                        - lblResBy:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =20
                              Size: =10
                              Text: |-
                                ="By: " & ThisItem.'Reserved By'
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =26
            - lblNoRes:
                Control: Label@2.5.1
                Properties:
                  Align: =Align.Center
                  Color: =varTheme.TextSecondary
                  Height: =28
                  PaddingLeft: =16
                  Size: =12
                  Text: ="No upcoming reservations"
                  Visible: =CountRows(colVehicleReservations) = 0
                  Width: =Parent.Width - 32
            - btnSetMaintenance:
                Control: Button@0.0.45
                Properties:
                  Align: =Align.Center
                  Appearance: ="Secondary"
                  BasePaletteColor: =varStatusColors.Maintenance
                  Height: =44
                  OnSelect: |-
                    =Patch(
                        CFSVehicles,
                        varSelectedVehicle,
                        {'Status (cr63e_status)': 'Status (CFSVehicles)'.Maintenance}
                    );
                    Notify("Vehicle set to maintenance", NotificationType.Success);
                    Navigate(scrVehicleList, ScreenTransition.Fade)
                  Text: ="Set Maintenance"
                  VerticalAlign: =VerticalAlign.Middle
                  Visible: =varSelectedVehicle.'Status (cr63e_status)' <> 'Status (CFSVehicles)'.Maintenance
                  Width: =Parent.Width - 32
            - btnClearMaintenance:
                Control: Button@0.0.45
                Properties:
                  BasePaletteColor: =varStatusColors.Available
                  Height: =44
                  OnSelect: |-
                    =Patch(
                        CFSVehicles,
                        varSelectedVehicle,
                        {'Status (cr63e_status)': 'Status (CFSVehicles)'.Available}
                    );
                    Notify("Vehicle back to available", NotificationType.Success);
                    Navigate(scrVehicleList, ScreenTransition.Fade)
                  Text: ="Clear Maintenance"
                  Visible: =varSelectedVehicle.'Status (cr63e_status)' = 'Status (CFSVehicles)'.Maintenance
                  Width: =Parent.Width - 32
