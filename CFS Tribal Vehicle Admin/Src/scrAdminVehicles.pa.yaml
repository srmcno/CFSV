# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
#
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
#
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrAdminVehicles:
    Properties:
      Fill: =varTheme.Background
      LoadingSpinnerColor: =varTheme.Primary
      OnVisible: |-
        =Set(varActiveScreen, "Vehicles");
        Set(varFilterStatus, "All");
        Set(varShowVehicleForm, false);
        Set(varIsNewVehicle, false);
        Set(varEditVehicle, Blank());
        Reset(txtVehicleSearch);
    Children:
      - cmpAdminNav_Vehicles:
          Control: CanvasComponent
          ComponentName: cmpAdminNav
          Properties:
            ActiveScreen: ="Vehicles"
            Height: =Parent.Height
            Width: =220
      - cnrVehiclesContent:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =varTheme.Background
            Height: =Parent.Height
            PaddingBottom: =0
            PaddingLeft: =0
            Width: =Parent.Width - 220
            X: =220
          Children:
            - cnrVehiclesHeader:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =64
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Width: =Parent.Width
                Children:
                  - lblVehiclesTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =40
                        PaddingLeft: =8
                        Size: =20
                        Text: ="Vehicle Fleet Management"
                        Width: =400
                        X: =24
                        Y: =12
                  - lblVehiclesCount:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =20
                        Size: =12
                        Text: =CountRows(CFSVehicles) & " vehicles"
                        Width: =200
                        X: =24
                        Y: =40
                  - btnAddVehicle:
                      Control: Button@0.0.45
                      Properties:
                        Height: =36
                        OnSelect: |-
                          =Set(varIsNewVehicle, true);
                          Set(varEditVehicle, Blank());
                          Set(varShowVehicleForm, true)
                        Text: ="+ Add Vehicle"
                        Width: =140
                        X: =Parent.Width - 164
                        Y: =14
            - cnrVehiclesFilters:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =52
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Width: =Parent.Width
                  Y: =64
                Children:
                  - txtVehicleSearch:
                      Control: TextInput@0.0.54
                      Properties:
                        Height: =36
                        Placeholder: ="Search by name, make, model, tag, or VIN..."
                        Width: =Parent.Width - 280
                        X: =24
                        Y: =8
                  - ddVehicleStatusFilter:
                      Control: DropDown@0.0.45
                      Properties:
                        Height: =36
                        Items: =["All", "Available", "Reserved", "Checked Out", "Maintenance", "Out Of Service"]
                        OnChange: =Set(varFilterStatus, Self.Selected.Value)
                        Width: =200
                        X: =Parent.Width - 224
                        Y: =8
            - cnrVehicleTableHeader:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Background
                  Height: =36
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Width: =Parent.Width
                  Y: =116
                Children:
                  - lblColName:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Vehicle Name"
                        Width: =160
                        X: =24
                  - lblColYMM:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Year / Make / Model"
                        Width: =180
                        X: =184
                  - lblColTag:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Tag"
                        Width: =90
                        X: =364
                  - lblColVIN:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="VIN"
                        Width: =170
                        X: =454
                  - lblColLocation:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Location"
                        Width: =110
                        X: =624
                  - lblColStatus:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Status"
                        Width: =90
                        X: =734
                  - lblColMileage:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Mileage"
                        Width: =80
                        X: =824
                  - lblColActions:
                      Control: Label@2.5.1
                      Properties:
                        Align: =Align.Center
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Actions"
                        Width: =100
                        X: =Parent.Width - 124
            - galVehicleTable:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_OneTextVariant_pcfCore
                Properties:
                  BorderColor: =varTheme.Border
                  Height: =Parent.Height - 152
                  Items: |-
                    =SortByColumns(
                        Filter(
                            CFSVehicles,
                            (varFilterStatus = "All" || Text('Status (cr63e_status)') = varFilterStatus) &&
                            (IsBlank(txtVehicleSearch.Value) ||
                             txtVehicleSearch.Value in 'Vehicle Name' ||
                             txtVehicleSearch.Value in Make ||
                             txtVehicleSearch.Value in Model ||
                             txtVehicleSearch.Value in Tag ||
                             txtVehicleSearch.Value in VIN)
                        ),
                        "cr63e_vehiclename",
                        SortOrder.Ascending
                    )
                  LoadingSpinner: =LoadingSpinner.Controls
                  TemplatePadding: =1
                  TemplateSize: =46
                  Width: =Parent.Width
                  Y: =152
                Children:
                  - cnrVehicleTableRow:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        Height: =Parent.TemplateHeight - 2
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Width: =Parent.TemplateWidth
                      Children:
                        - recVehRowAccent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: |-
                                =Switch(
                                    ThisItem.'Status (cr63e_status)',
                                    'Status (CFSVehicles)'.Available, varStatusColors.Available,
                                    'Status (CFSVehicles)'.'Checked Out', varStatusColors.CheckedOut,
                                    'Status (CFSVehicles)'.Reserved, varStatusColors.Reserved,
                                    'Status (CFSVehicles)'.Maintenance, varStatusColors.Maintenance,
                                    RGBA(96, 94, 92, 1)
                                )
                              Height: =Parent.Height
                              Width: =4
                        - lblRowName:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              Size: =12
                              Text: =ThisItem.'Vehicle Name'
                              Width: =160
                              X: =24
                        - lblRowYMM:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =ThisItem.Year & " " & ThisItem.Make & " " & ThisItem.Model
                              Width: =180
                              X: =184
                        - lblRowTag:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =ThisItem.Tag
                              Width: =90
                              X: =364
                        - lblRowVIN:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =10
                              Text: =ThisItem.VIN
                              Width: =170
                              X: =454
                        - lblRowLocation:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =ThisItem.Location
                              Width: =110
                              X: =624
                        - lblRowStatus:
                            Control: Label@2.5.1
                            Properties:
                              Color: |-
                                =Switch(
                                    ThisItem.'Status (cr63e_status)',
                                    'Status (CFSVehicles)'.Available, varStatusColors.Available,
                                    'Status (CFSVehicles)'.'Checked Out', varStatusColors.CheckedOut,
                                    'Status (CFSVehicles)'.Reserved, varStatusColors.Reserved,
                                    'Status (CFSVehicles)'.Maintenance, varStatusColors.Maintenance,
                                    varTheme.TextSecondary
                                )
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              Size: =10
                              Text: =Upper(Text(ThisItem.'Status (cr63e_status)'))
                              Width: =90
                              X: =734
                        - lblRowMileage:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =Text(ThisItem.'Current Mileage', "#,##0")
                              Width: =80
                              X: =824
                        - btnRowEdit:
                            Control: Button@0.0.45
                            Properties:
                              Appearance: ="Secondary"
                              FontSize: =11
                              Height: =30
                              OnSelect: |-
                                =Set(varIsNewVehicle, false);
                                Set(varEditVehicle, ThisItem);
                                Set(varShowVehicleForm, true)
                              Text: ="Edit"
                              Width: =46
                              X: =Parent.Width - 118
                              Y: =8
                        - btnRowView:
                            Control: Button@0.0.45
                            Properties:
                              Appearance: ="Transparent"
                              FontColor: =varTheme.Primary
                              FontSize: =11
                              Height: =30
                              OnSelect: |-
                                =Set(varSelectedVehicle, ThisItem)
                              Text: ="View"
                              Width: =46
                              X: =Parent.Width - 66
                              Y: =8
                        - recVehRowDivider:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varTheme.Border
                              Height: =1
                              Width: =Parent.Width - 24
                              X: =24
                              Y: =Parent.Height - 1
      - cnrVehicleFormOverlay:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =RGBA(0, 0, 0, 0.5)
            Height: =Parent.Height
            PaddingBottom: =0
            PaddingLeft: =0
            Visible: =varShowVehicleForm
            Width: =Parent.Width
          Children:
            - cnrVehicleFormModal:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =620
                  PaddingBottom: =0
                  PaddingLeft: =0
                  RadiusBottomLeft: =12
                  RadiusBottomRight: =12
                  RadiusTopLeft: =12
                  RadiusTopRight: =12
                  Width: =520
                  X: =(Parent.Width - 520) / 2
                  Y: =(Parent.Height - 620) / 2
                Children:
                  - lblFormTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =40
                        PaddingLeft: =8
                        Size: =18
                        Text: =If(varIsNewVehicle, "Add New Vehicle", "Edit Vehicle")
                        Width: =400
                        X: =24
                        Y: =16
                  - btnFormClose:
                      Control: Button@0.0.45
                      Properties:
                        Appearance: ="Transparent"
                        FontColor: =varTheme.TextSecondary
                        Height: =36
                        OnSelect: =Set(varShowVehicleForm, false)
                        Text: ="X"
                        Width: =36
                        X: =Parent.Width - 52
                        Y: =16
                  - recFormDivider:
                      Control: Rectangle@2.3.0
                      Properties:
                        Fill: =varTheme.Border
                        Height: =1
                        Width: =Parent.Width - 48
                        X: =24
                        Y: =56
                  - lblFormVehicleName:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Vehicle Name *"
                        Width: =220
                        X: =24
                        Y: =68
                  - txtFormVehicleName:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.'Vehicle Name', "")
                        Height: =36
                        Width: =456
                        X: =24
                        Y: =92
                  - lblFormYear:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Year"
                        Width: =100
                        X: =24
                        Y: =136
                  - txtFormYear:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.Year, "")
                        Height: =36
                        Width: =100
                        X: =24
                        Y: =160
                  - lblFormMake:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Make"
                        Width: =160
                        X: =140
                        Y: =136
                  - txtFormMake:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.Make, "")
                        Height: =36
                        Width: =160
                        X: =140
                        Y: =160
                  - lblFormModel:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Model"
                        Width: =164
                        X: =316
                        Y: =136
                  - txtFormModel:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.Model, "")
                        Height: =36
                        Width: =164
                        X: =316
                        Y: =160
                  - lblFormTag:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Tag"
                        Width: =220
                        X: =24
                        Y: =204
                  - txtFormTag:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.Tag, "")
                        Height: =36
                        Width: =220
                        X: =24
                        Y: =228
                  - lblFormVIN:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="VIN"
                        Width: =236
                        X: =260
                        Y: =204
                  - txtFormVIN:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.VIN, "")
                        Height: =36
                        Width: =220
                        X: =260
                        Y: =228
                  - lblFormLocation:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Location"
                        Width: =220
                        X: =24
                        Y: =272
                  - txtFormLocation:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, varEditVehicle.Location, "")
                        Height: =36
                        Width: =220
                        X: =24
                        Y: =296
                  - lblFormMileage:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Current Mileage"
                        Width: =220
                        X: =260
                        Y: =272
                  - txtFormMileage:
                      Control: TextInput@0.0.54
                      Properties:
                        Default: =If(!varIsNewVehicle, Text(varEditVehicle.'Current Mileage'), "")
                        Height: =36
                        Width: =220
                        X: =260
                        Y: =296
                  - lblFormStatus:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =24
                        Size: =12
                        Text: ="Status"
                        Width: =220
                        X: =24
                        Y: =340
                  - ddFormStatus:
                      Control: DropDown@0.0.45
                      Properties:
                        DefaultSelectedItems: =If(!varIsNewVehicle, [Text(varEditVehicle.'Status (cr63e_status)')], ["Available"])
                        Height: =36
                        Items: =["Available", "Reserved", "Checked Out", "Maintenance", "Out Of Service"]
                        Width: =220
                        X: =24
                        Y: =364
                  - recFormBottomDivider:
                      Control: Rectangle@2.3.0
                      Properties:
                        Fill: =varTheme.Border
                        Height: =1
                        Width: =Parent.Width - 48
                        X: =24
                        Y: =520
                  - btnFormCancel:
                      Control: Button@0.0.45
                      Properties:
                        Appearance: ="Secondary"
                        Height: =40
                        OnSelect: =Set(varShowVehicleForm, false)
                        Text: ="Cancel"
                        Width: =120
                        X: =Parent.Width - 280
                        Y: =540
                  - btnFormSave:
                      Control: Button@0.0.45
                      Properties:
                        Height: =40
                        OnSelect: |-
                          =Set(varIsSubmitting, true);
                          If(
                              varIsNewVehicle,
                              // Create new vehicle
                              Patch(
                                  CFSVehicles,
                                  Defaults(CFSVehicles),
                                  {
                                      'Vehicle Name': txtFormVehicleName.Value,
                                      Year: txtFormYear.Value,
                                      Make: txtFormMake.Value,
                                      Model: txtFormModel.Value,
                                      Tag: txtFormTag.Value,
                                      VIN: txtFormVIN.Value,
                                      Location: txtFormLocation.Value,
                                      'Current Mileage': Value(txtFormMileage.Value)
                                  }
                              ),
                              // Update existing vehicle
                              Patch(
                                  CFSVehicles,
                                  varEditVehicle,
                                  {
                                      'Vehicle Name': txtFormVehicleName.Value,
                                      Year: txtFormYear.Value,
                                      Make: txtFormMake.Value,
                                      Model: txtFormModel.Value,
                                      Tag: txtFormTag.Value,
                                      VIN: txtFormVIN.Value,
                                      Location: txtFormLocation.Value,
                                      'Current Mileage': Value(txtFormMileage.Value)
                                  }
                              )
                          );
                          Set(varIsSubmitting, false);
                          Set(varShowVehicleForm, false)
                        Text: =If(varIsSubmitting, "Saving...", If(varIsNewVehicle, "Create Vehicle", "Save Changes"))
                        Width: =140
                        X: =Parent.Width - 148
                        Y: =540
