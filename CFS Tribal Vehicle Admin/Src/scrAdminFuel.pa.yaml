# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
#
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
#
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  scrAdminFuel:
    Properties:
      Fill: =varTheme.Background
      LoadingSpinnerColor: =varTheme.Primary
      OnVisible: |-
        =Set(varActiveScreen, "Fuel");
        Set(varFuelFilterStart, Date(Year(Today()), Month(Today()), 1));
        Set(varFuelFilterEnd, Today());
        Set(varFuelFilterSource, "All");
        Set(varFuelFilterVehicle, Blank());
        Set(varShowFuelCards, false);

        // Load fuel transactions
        ClearCollect(
            colAdminFuel,
            Sort(
                Filter(
                    'Fuel Transactions',
                    TransactionDateTime >= varFuelFilterStart &&
                    TransactionDateTime <= varFuelFilterEnd
                ),
                TransactionDateTime,
                SortOrder.Descending
            )
        );

        // Calculate KPIs
        Set(
            varFuelMonthlyTotal,
            Sum(colAdminFuel, Amount)
        );
        Set(
            varFuelTotalGallons,
            Sum(colAdminFuel, Gallons)
        );
        Set(
            varFuelTransactionCount,
            CountRows(colAdminFuel)
        );
        Set(
            varFuelAvgPerVehicle,
            If(
                CountRows(CFSVehicles) > 0,
                varFuelMonthlyTotal / CountRows(CFSVehicles),
                0
            )
        );

        // Load fuel card assignments
        ClearCollect(
            colFuelCards,
            Sort('Fuel Card Assignments', Vehicle.'Vehicle Name')
        );
    Children:
      - cmpAdminNav_Fuel:
          Control: CanvasComponent
          ComponentName: cmpAdminNav
          Properties:
            ActiveScreen: ="Fuel"
            Height: =Parent.Height
            Width: =220
      - cnrFuelContent:
          Control: GroupContainer@1.4.0
          Variant: ManualLayout
          Properties:
            Fill: =varTheme.Background
            Height: =Parent.Height
            PaddingBottom: =0
            PaddingLeft: =0
            Width: =Parent.Width - 220
            X: =220
          Children:
            - cnrFuelHeader:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =64
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Width: =Parent.Width
                Children:
                  - lblFuelTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Bold
                        Height: =40
                        PaddingLeft: =8
                        Size: =20
                        Text: ="Fuel Management"
                        Width: =400
                        X: =24
                        Y: =12
                  - lblFuelSubtitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =20
                        Size: =12
                        Text: =varFuelTransactionCount & " transactions this period"
                        Width: =300
                        X: =24
                        Y: =40
                  - btnManageFuelCards:
                      Control: Button@0.0.45
                      Properties:
                        Appearance: =If(varShowFuelCards, "Primary", "Secondary")
                        Height: =36
                        OnSelect: =Set(varShowFuelCards, !varShowFuelCards)
                        Text: =If(varShowFuelCards, "View Transactions", "Manage Fuel Cards")
                        Width: =170
                        X: =Parent.Width - 194
                        Y: =14
            - cnrFuelKPIRow:
                Control: GroupContainer@1.4.0
                Variant: AutoLayout
                Properties:
                  FillPortions: =0
                  Height: =90
                  LayoutAlignItems: =LayoutAlignItems.Stretch
                  LayoutDirection: =LayoutDirection.Horizontal
                  LayoutGap: =16
                  PaddingLeft: =24
                  PaddingRight: =24
                  PaddingTop: =16
                  Visible: =!varShowFuelCards
                  Width: =Parent.Width
                  Y: =64
                Children:
                  - cnrFuelKPIMonthly:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        FillPortions: =1
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                      Children:
                        - recFuelKPI1Accent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varTheme.Primary
                              Height: =3
                              Width: =Parent.Width
                        - lblFuelKPI1Value:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =30
                              Size: =18
                              Text: ="$" & Text(varFuelMonthlyTotal, "#,##0.00")
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =12
                        - lblFuelKPI1Label:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =20
                              Size: =11
                              Text: ="Monthly Total"
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =42
                  - cnrFuelKPIAvg:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        FillPortions: =1
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                      Children:
                        - recFuelKPI2Accent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varStatusColors.Available
                              Height: =3
                              Width: =Parent.Width
                        - lblFuelKPI2Value:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =30
                              Size: =18
                              Text: ="$" & Text(varFuelAvgPerVehicle, "#,##0.00")
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =12
                        - lblFuelKPI2Label:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =20
                              Size: =11
                              Text: ="Avg per Vehicle"
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =42
                  - cnrFuelKPIGallons:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        FillPortions: =1
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                      Children:
                        - recFuelKPI3Accent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varStatusColors.Reserved
                              Height: =3
                              Width: =Parent.Width
                        - lblFuelKPI3Value:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =30
                              Size: =18
                              Text: =Text(varFuelTotalGallons, "#,##0.0") & " gal"
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =12
                        - lblFuelKPI3Label:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =20
                              Size: =11
                              Text: ="Total Gallons"
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =42
                  - cnrFuelKPICount:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        FillPortions: =1
                        RadiusBottomLeft: =8
                        RadiusBottomRight: =8
                        RadiusTopLeft: =8
                        RadiusTopRight: =8
                      Children:
                        - recFuelKPI4Accent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varStatusColors.Maintenance
                              Height: =3
                              Width: =Parent.Width
                        - lblFuelKPI4Value:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =30
                              Size: =18
                              Text: =varFuelTransactionCount
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =12
                        - lblFuelKPI4Label:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =20
                              Size: =11
                              Text: ="Transaction Count"
                              Width: =Parent.Width - 24
                              X: =12
                              Y: =42
            - cnrFuelFilters:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Surface
                  Height: =52
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Visible: =!varShowFuelCards
                  Width: =Parent.Width
                  Y: =170
                Children:
                  - lblFuelFilterFrom:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =36
                        Size: =11
                        Text: ="From:"
                        Width: =40
                        X: =24
                        Y: =8
                  - dpFuelFilterStart:
                      Control: DatePicker@0.0.46
                      Properties:
                        Height: =36
                        OnChange: |-
                          =Set(varFuelFilterStart, Self.SelectedDate);
                          ClearCollect(
                              colAdminFuel,
                              Sort(
                                  Filter(
                                      'Fuel Transactions',
                                      TransactionDateTime >= varFuelFilterStart &&
                                      TransactionDateTime <= varFuelFilterEnd &&
                                      (varFuelFilterSource = "All" || Text(Source) = varFuelFilterSource)
                                  ),
                                  TransactionDateTime,
                                  SortOrder.Descending
                              )
                          )
                        SelectedDate: =varFuelFilterStart
                        Width: =160
                        X: =68
                        Y: =8
                  - lblFuelFilterTo:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        Height: =36
                        Size: =11
                        Text: ="To:"
                        Width: =30
                        X: =240
                        Y: =8
                  - dpFuelFilterEnd:
                      Control: DatePicker@0.0.46
                      Properties:
                        Height: =36
                        OnChange: |-
                          =Set(varFuelFilterEnd, Self.SelectedDate);
                          ClearCollect(
                              colAdminFuel,
                              Sort(
                                  Filter(
                                      'Fuel Transactions',
                                      TransactionDateTime >= varFuelFilterStart &&
                                      TransactionDateTime <= varFuelFilterEnd &&
                                      (varFuelFilterSource = "All" || Text(Source) = varFuelFilterSource)
                                  ),
                                  TransactionDateTime,
                                  SortOrder.Descending
                              )
                          )
                        SelectedDate: =varFuelFilterEnd
                        Width: =160
                        X: =274
                        Y: =8
                  - ddFuelSourceFilter:
                      Control: DropDown@0.0.45
                      Properties:
                        Height: =36
                        Items: =["All", "Manual", "Import", "VoyagerFeed"]
                        OnChange: |-
                          =Set(varFuelFilterSource, Self.Selected.Value);
                          ClearCollect(
                              colAdminFuel,
                              Sort(
                                  Filter(
                                      'Fuel Transactions',
                                      TransactionDateTime >= varFuelFilterStart &&
                                      TransactionDateTime <= varFuelFilterEnd &&
                                      (varFuelFilterSource = "All" || Text(Source) = varFuelFilterSource)
                                  ),
                                  TransactionDateTime,
                                  SortOrder.Descending
                              )
                          )
                        Width: =160
                        X: =460
                        Y: =8
            - cnrFuelTableHeader:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Background
                  Height: =36
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Visible: =!varShowFuelCards
                  Width: =Parent.Width
                  Y: =222
                Children:
                  - lblFuelColDate:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Date"
                        Width: =130
                        X: =24
                  - lblFuelColVehicle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Vehicle"
                        Width: =160
                        X: =154
                  - lblFuelColAmount:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Amount"
                        Width: =100
                        X: =314
                  - lblFuelColGallons:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Gallons"
                        Width: =80
                        X: =414
                  - lblFuelColPPG:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="PPG"
                        Width: =80
                        X: =494
                  - lblFuelColSource:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Source"
                        Width: =100
                        X: =574
                  - lblFuelColSubmitted:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextSecondary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        Size: =11
                        Text: ="Submitted By"
                        Width: =140
                        X: =674
            - galFuelTable:
                Control: Gallery@2.15.0
                Variant: BrowseLayout_Vertical_OneTextVariant_pcfCore
                Properties:
                  BorderColor: =varTheme.Border
                  Height: =Parent.Height - 258
                  Items: =colAdminFuel
                  LoadingSpinner: =LoadingSpinner.Controls
                  TemplatePadding: =1
                  TemplateSize: =44
                  Visible: =!varShowFuelCards
                  Width: =Parent.Width
                  Y: =258
                Children:
                  - cnrFuelTableRow:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Surface
                        Height: =Parent.TemplateHeight - 2
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Width: =Parent.TemplateWidth
                      Children:
                        - recFuelRowAccent:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: |-
                                =Switch(
                                    Text(ThisItem.Source),
                                    "Manual", varTheme.Primary,
                                    "VoyagerFeed", varStatusColors.Available,
                                    "Import", varStatusColors.Warning,
                                    RGBA(96, 94, 92, 1)
                                )
                              Height: =Parent.Height
                              Width: =4
                        - lblFuelRowDate:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =Text(ThisItem.TransactionDateTime, "mmm d, yyyy h:mm")
                              Width: =130
                              X: =24
                        - lblFuelRowVehicle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Semibold
                              Height: =Parent.Height
                              Size: =11
                              Text: =ThisItem.Vehicle.'Vehicle Name'
                              Width: =160
                              X: =154
                        - lblFuelRowAmount:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextPrimary
                              FontWeight: =FontWeight.Bold
                              Height: =Parent.Height
                              Size: =12
                              Text: ="$" & Text(ThisItem.Amount, "#,##0.00")
                              Width: =100
                              X: =314
                        - lblFuelRowGallons:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =Text(ThisItem.Gallons, "#,##0.00")
                              Width: =80
                              X: =414
                        - lblFuelRowPPG:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =11
                              Text: =If(ThisItem.Gallons > 0, "$" & Text(ThisItem.Amount / ThisItem.Gallons, "#.00"), "N/A")
                              Width: =80
                              X: =494
                        - lblFuelRowSource:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =10
                              Text: =Text(ThisItem.Source)
                              Width: =100
                              X: =574
                        - lblFuelRowSubmitted:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              Height: =Parent.Height
                              Size: =10
                              Text: =ThisItem.SubmittedBy.Associate
                              Width: =140
                              X: =674
                        - recFuelRowDivider:
                            Control: Rectangle@2.3.0
                            Properties:
                              Fill: =varTheme.Border
                              Height: =1
                              Width: =Parent.Width - 24
                              X: =24
                              Y: =Parent.Height - 1
            - cnrFuelCardsSection:
                Control: GroupContainer@1.4.0
                Variant: ManualLayout
                Properties:
                  Fill: =varTheme.Background
                  Height: =Parent.Height - 64
                  PaddingBottom: =0
                  PaddingLeft: =0
                  Visible: =varShowFuelCards
                  Width: =Parent.Width
                  Y: =64
                Children:
                  - lblFuelCardsTitle:
                      Control: Label@2.5.1
                      Properties:
                        Color: =varTheme.TextPrimary
                        FontWeight: =FontWeight.Semibold
                        Height: =36
                        PaddingLeft: =8
                        Size: =16
                        Text: ="Fuel Card Assignments"
                        Width: =300
                        X: =24
                        Y: =16
                  - cnrFuelCardTableHeader:
                      Control: GroupContainer@1.4.0
                      Variant: ManualLayout
                      Properties:
                        Fill: =varTheme.Background
                        Height: =36
                        PaddingBottom: =0
                        PaddingLeft: =0
                        Width: =Parent.Width
                        Y: =56
                      Children:
                        - lblFCColVehicle:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              FontWeight: =FontWeight.Semibold
                              Height: =36
                              Size: =11
                              Text: ="Vehicle"
                              Width: =250
                              X: =24
                        - lblFCColCard:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              FontWeight: =FontWeight.Semibold
                              Height: =36
                              Size: =11
                              Text: ="Card Last 4"
                              Width: =120
                              X: =274
                        - lblFCColActive:
                            Control: Label@2.5.1
                            Properties:
                              Color: =varTheme.TextSecondary
                              FontWeight: =FontWeight.Semibold
                              Height: =36
                              Size: =11
                              Text: ="Active"
                              Width: =80
                              X: =394
                        - lblFCColActions:
                            Control: Label@2.5.1
                            Properties:
                              Align: =Align.Center
                              Color: =varTheme.TextSecondary
                              FontWeight: =FontWeight.Semibold
                              Height: =36
                              Size: =11
                              Text: ="Actions"
                              Width: =160
                              X: =494
                  - galFuelCards:
                      Control: Gallery@2.15.0
                      Variant: BrowseLayout_Vertical_OneTextVariant_pcfCore
                      Properties:
                        BorderColor: =varTheme.Border
                        Height: =Parent.Height - 96
                        Items: =colFuelCards
                        LoadingSpinner: =LoadingSpinner.Controls
                        TemplatePadding: =1
                        TemplateSize: =44
                        Width: =Parent.Width
                        Y: =92
                      Children:
                        - cnrFuelCardRow:
                            Control: GroupContainer@1.4.0
                            Variant: ManualLayout
                            Properties:
                              Fill: =varTheme.Surface
                              Height: =Parent.TemplateHeight - 2
                              PaddingBottom: =0
                              PaddingLeft: =0
                              Width: =Parent.TemplateWidth
                            Children:
                              - recFCRowAccent:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    Fill: =If(ThisItem.IsActive, varStatusColors.Available, varStatusColors.Maintenance)
                                    Height: =Parent.Height
                                    Width: =4
                              - lblFCRowVehicle:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =varTheme.TextPrimary
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    Size: =12
                                    Text: =ThisItem.Vehicle.'Vehicle Name'
                                    Width: =250
                                    X: =24
                              - lblFCRowCard:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =varTheme.TextPrimary
                                    Height: =Parent.Height
                                    Size: =12
                                    Text: ="****" & ThisItem.CardLast4
                                    Width: =120
                                    X: =274
                              - lblFCRowActive:
                                  Control: Label@2.5.1
                                  Properties:
                                    Color: =If(ThisItem.IsActive, varStatusColors.Available, varStatusColors.Cancelled)
                                    FontWeight: =FontWeight.Semibold
                                    Height: =Parent.Height
                                    Size: =11
                                    Text: =If(ThisItem.IsActive, "Active", "Inactive")
                                    Width: =80
                                    X: =394
                              - btnFCToggle:
                                  Control: Button@0.0.45
                                  Properties:
                                    Appearance: ="Secondary"
                                    BasePaletteColor: =If(ThisItem.IsActive, varStatusColors.Cancelled, varStatusColors.Available)
                                    FontSize: =10
                                    Height: =28
                                    OnSelect: |-
                                      =Patch(
                                          'Fuel Card Assignments',
                                          ThisItem,
                                          {
                                              IsActive: !ThisItem.IsActive
                                          }
                                      );
                                      ClearCollect(
                                          colFuelCards,
                                          Sort('Fuel Card Assignments', Vehicle.'Vehicle Name')
                                      )
                                    Text: =If(ThisItem.IsActive, "Deactivate", "Activate")
                                    Width: =90
                                    X: =494
                                    Y: =8
                              - recFCRowDivider:
                                  Control: Rectangle@2.3.0
                                  Properties:
                                    Fill: =varTheme.Border
                                    Height: =1
                                    Width: =Parent.Width - 24
                                    X: =24
                                    Y: =Parent.Height - 1
