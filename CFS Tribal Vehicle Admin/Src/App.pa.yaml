# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
#
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
#
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
App:
  Properties:
    OnStart: |-
      =// Initialize user variables
      Set(varCurrentUser, User());
      Set(varUserEmail, User().Email);
      Set(varUserDisplayName, User().FullName);
      Set(
          varUserAssociate,
          LookUp(Associates, Associate = varUserDisplayName)
      );
      Set(varToday, Today());
      Set(varNow, Now());

      // Admin role check - for now always true
      Set(varIsAdmin, true);

      // Active screen tracking for navigation
      Set(varActiveScreen, "Dashboard");

      // Theme colors - Centralized for easy updates
      Set(
          varTheme,
          {
              Primary: RGBA(0, 120, 212, 1),
              PrimaryDark: RGBA(0, 90, 158, 1),
              PrimaryLight: RGBA(199, 224, 244, 1),
              Success: RGBA(16, 124, 16, 1),
              Warning: RGBA(255, 185, 0, 1),
              Danger: RGBA(209, 52, 56, 1),
              Background: RGBA(243, 242, 241, 1),
              Surface: RGBA(255, 255, 255, 1),
              TextPrimary: RGBA(50, 49, 48, 1),
              TextSecondary: RGBA(96, 94, 92, 1),
              TextOnPrimary: RGBA(255, 255, 255, 1),
              Border: RGBA(237, 235, 233, 1)
          }
      );

      // Status colors - Mapped to Entity Status Reasons
      Set(
          varStatusColors,
          {
              Available: RGBA(16, 124, 16, 1),
              CheckedOut: RGBA(209, 52, 56, 1),
              Reserved: RGBA(255, 185, 0, 1),
              Warning: RGBA(255, 185, 0, 1),
              Maintenance: RGBA(138, 136, 134, 1),
              Draft: RGBA(0, 120, 212, 1),
              Submitted: RGBA(0, 120, 212, 1),
              Approved: RGBA(16, 124, 16, 1),
              Cancelled: RGBA(209, 52, 56, 1),
              OutOfService: RGBA(168, 0, 0, 1)
          }
      );

      // Admin-specific state variables
      Set(varSelectedVehicle, Blank());
      Set(varSelectedAssociate, Blank());
      Set(varSelectedReservation, Blank());
      Set(varSelectedMaintenance, Blank());
      Set(varSelectedFuelTransaction, Blank());
      Set(varFilterStatus, "All");
      Set(varIsSubmitting, false);
      Set(varPatchResult, Blank());

      // Vehicle form state
      Set(varShowVehicleForm, false);
      Set(varIsNewVehicle, false);
      Set(varEditVehicle, Blank());

      // Reservation admin state
      Set(varResFilterStatus, "All");
      Set(varResFilterStart, Today() - 30);
      Set(varResFilterEnd, Today() + 30);
      Set(varShowResForm, false);
      Set(varIsNewRes, false);

      // Fuel admin state
      Set(varFuelFilterStart, Date(Year(Today()), Month(Today()), 1));
      Set(varFuelFilterEnd, Today());
      Set(varFuelFilterVehicle, Blank());
      Set(varFuelFilterSource, "All");
      Set(varShowFuelCards, false);

      // Maintenance admin state
      Set(varMaintFilterStatus, "All");
      Set(varMaintFilterVehicle, Blank());

      // Associate admin state
      Set(varShowAssociateForm, false);
      Set(varIsNewAssociate, false);
      Set(varEditAssociate, Blank());
      Set(varAssociateSearch, "");

      // Dashboard KPIs
      Set(varTotalVehicles, 0);
      Set(varAvailableCount, 0);
      Set(varCheckedOutCount, 0);
      Set(varMaintenanceCount, 0);
      Set(varReservedCount, 0);
      Set(varPendingResCount, 0);
      Set(varFuelSpendMonth, 0);
      Set(varActiveCheckouts, 0);
      Set(varOpenMaintenance, 0);
    Theme: =PowerAppsTheme
